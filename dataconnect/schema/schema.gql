# Defines the data model for the Theraway application.

enum UserRole {
  CLIENT
  THERAPIST
  CLINIC_OWNER
  ADMIN
}

# User table, keyed by Firebase Auth UID.
type User @table {
  id: String! @default(expr: "auth.uid")
  email: String! @unique
  fullName: String!
  role: UserRole! @default(value: "CLIENT")
  createdAt: Timestamp! @default(expr: "request.time")
}

# Therapist profile, linked to a User.
type Therapist @table {
  id: UUID! @default(expr: "uuidV4()")
  user: User! # Foreign key to the User table
  profilePictureUrl: String
  bio: String
  specialties: [String!]
  location: String
  languages: [String!]
  averageRating: Float
  hourlyRate: Float
}

# Clinic, owned by a User (CLINIC_OWNER).
type Clinic @table {
  id: UUID! @default(expr: "uuidV4()")
  owner: User! # Foreign key to the User table
  name: String!
  location: String!
  contactEmail: String
}

# A rentable space within a clinic.
type ClinicSpace @table {
  id: UUID! @default(expr: "uuidV4()")
  clinic: Clinic! # Foreign key to the Clinic table
  name: String!
  imageUrl: String
  description: String
  hourlyRate: Float!
}

# Represents a booking of a clinic space by a therapist for a client.
type Booking @table {
  id: UUID! @default(expr: "uuidV4()")
  client: User!       # The client for the appointment
  therapist: Therapist! # The therapist conducting the appointment
  clinicSpace: ClinicSpace! # The space being booked
  startTime: Timestamp!
  endTime: Timestamp!
  totalCost: Float!
  status: String! # e.g., "CONFIRMED", "CANCELLED"
}

# A review of a therapist by a client.
type Review @table(key: ["client", "therapist"]) {
  client: User!      # The client who wrote the review
  therapist: Therapist! # The therapist being reviewed
  rating: Int!          # Rating from 1 to 5
  comment: String
  createdAt: Timestamp! @default(expr: "request.time")
}

# An appointment between a therapist and a client.
type Appointment @table {
    id: UUID! @default(expr: "uuidV4()")
    client: User!
    therapist: Therapist!
    booking: Booking # Can be null if it's a virtual appointment
    startTime: Timestamp!
    status: String! # e.g., "SCHEDULED", "COMPLETED", "CANCELLED"
    notes: String # Private notes for the therapist
}